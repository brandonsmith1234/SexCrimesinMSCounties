<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>County Circuit Courts or Relevant Locations of CWRGM Letters Related to Sex Crimes</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="data/CrimeCountbyCounty_1.js"></script>
        <script src="data/CWRGMLetters_2.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[30.290324042567086,-94.22455287561324],[35.35359939684812,-84.54553603718695]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var title = new L.Control({'position':'topright'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>County Circuit Courts or Relevant Locations of CWRGM Letters Related to Sex Crimes</h2>';
        };
        title.addTo(map);
        var abstract = new L.Control({'position':'bottomleft'});
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div',
            'leaflet-control abstract');
            this._div.id = 'abstract'
                this._div.setAttribute("onmouseenter", "abstract.show()");
                this._div.setAttribute("onmouseleave", "abstract.hide()");
                this.hide();
                return this._div;
            };
            abstract.hide = function () {
                this._div.classList.remove("abstractUncollapsed");
                this._div.classList.add("abstract");
                this._div.innerHTML = 'i'
            }
            abstract.show = function () {
                this._div.classList.remove("abstract");
                this._div.classList.add("abstractUncollapsed");
                this._div.innerHTML = 'The letters pinned on this map are from the Civil War and Reconstruction Governors of Mississippi (CWRGM) archive collection. Each dot contains summarizing information about the court cases that were disputed by that county\'s circuit court or dicuss crime(s) that might have occured with the county. The letters chosen pertain to any 5 of these sexual crimes: Adultery, Rape and Sexual Assualt, Fornication, Unlawful Cohabitation, and Sex Work. The hue of a particular county indicates how many letter mention it as a relevant location. Click on the pink-colored dots to learn about the contents discussed in 27 different letters.';
        };
        abstract.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_Basemap_0');
        map.getPane('pane_Basemap_0').style.zIndex = 400;
        var layer_Basemap_0 = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
            pane: 'pane_Basemap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
        });
        layer_Basemap_0;
        map.addLayer(layer_Basemap_0);
        function pop_CrimeCountbyCounty_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">County</th>\
                        <td>' + (feature.properties['NHGISNAM'] !== null ? autolinker.link(feature.properties['NHGISNAM'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Crimes</th>\
                        <td>' + (feature.properties['Crime_Coun'] !== null ? autolinker.link(feature.properties['Crime_Coun'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_CrimeCountbyCounty_1_0(feature) {
            if (feature.properties['Crime_Coun'] >= 0.000000 && feature.properties['Crime_Coun'] <= 0.990000 ) {
                return {
                pane: 'pane_CrimeCountbyCounty_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(247,251,255,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Crime_Coun'] >= 0.990000 && feature.properties['Crime_Coun'] <= 1.980000 ) {
                return {
                pane: 'pane_CrimeCountbyCounty_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(175,209,231,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Crime_Coun'] >= 1.980000 && feature.properties['Crime_Coun'] <= 2.970000 ) {
                return {
                pane: 'pane_CrimeCountbyCounty_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(62,142,196,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Crime_Coun'] >= 2.970000 && feature.properties['Crime_Coun'] <= 3.960000 ) {
                return {
                pane: 'pane_CrimeCountbyCounty_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(8,48,107,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_CrimeCountbyCounty_1');
        map.getPane('pane_CrimeCountbyCounty_1').style.zIndex = 401;
        map.getPane('pane_CrimeCountbyCounty_1').style['mix-blend-mode'] = 'normal';
        var layer_CrimeCountbyCounty_1 = new L.geoJson(json_CrimeCountbyCounty_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_CrimeCountbyCounty_1',
            layerName: 'layer_CrimeCountbyCounty_1',
            pane: 'pane_CrimeCountbyCounty_1',
            onEachFeature: pop_CrimeCountbyCounty_1,
            style: style_CrimeCountbyCounty_1_0,
        });
        bounds_group.addLayer(layer_CrimeCountbyCounty_1);
        map.addLayer(layer_CrimeCountbyCounty_1);
        function pop_CWRGMLetters_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Title</th>\
                        <td>' + (feature.properties['Title'] !== null ? autolinker.link(feature.properties['Title'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Date</th>\
                        <td>' + (feature.properties['Date'] !== null ? autolinker.link(feature.properties['Date'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Subject</th>\
                        <td>' + (feature.properties['Subject'] !== null ? autolinker.link(feature.properties['Subject'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Image</th>\
                        <td>' + (feature.properties['Image'] !== null ? autolinker.link(feature.properties['Image'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Accused</th>\
                        <td>' + (feature.properties['Accused'] !== null ? autolinker.link(feature.properties['Accused'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Victim</th>\
                        <td>' + (feature.properties['Victim'] !== null ? autolinker.link(feature.properties['Victim'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Description</strong><br />' + (feature.properties['Description'] !== null ? autolinker.link(feature.properties['Description'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Petition</th>\
                        <td>' + (feature.properties['Petition'] !== null ? autolinker.link(feature.properties['Petition'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Pardoned</th>\
                        <td>' + (feature.properties['Pardoned'] !== null ? autolinker.link(feature.properties['Pardoned'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['URL'] !== null ? autolinker.link(feature.properties['URL'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_CWRGMLetters_2_0() {
            return {
                pane: 'pane_CWRGMLetters_2',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(243,166,178,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_CWRGMLetters_2');
        map.getPane('pane_CWRGMLetters_2').style.zIndex = 402;
        map.getPane('pane_CWRGMLetters_2').style['mix-blend-mode'] = 'normal';
        var layer_CWRGMLetters_2 = new L.geoJson(json_CWRGMLetters_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_CWRGMLetters_2',
            layerName: 'layer_CWRGMLetters_2',
            pane: 'pane_CWRGMLetters_2',
            onEachFeature: pop_CWRGMLetters_2,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_CWRGMLetters_2_0(feature));
            },
        });
        bounds_group.addLayer(layer_CWRGMLetters_2);
        map.addLayer(layer_CWRGMLetters_2);
        var baseMaps = {};
        var overlaysTree = [
            {label: '<img src="legend/CWRGMLetters_2.png" /> CWRGM Letters', layer: layer_CWRGMLetters_2},
            {label: 'Crime Count by County<br /><table><tr><td style="text-align: center;"><img src="legend/CrimeCountbyCounty_1_00.png" /></td><td>0</td></tr><tr><td style="text-align: center;"><img src="legend/CrimeCountbyCounty_1_11.png" /></td><td>1</td></tr><tr><td style="text-align: center;"><img src="legend/CrimeCountbyCounty_1_22.png" /></td><td>2</td></tr><tr><td style="text-align: center;"><img src="legend/CrimeCountbyCounty_1_33.png" /></td><td>3</td></tr></table>', layer: layer_CrimeCountbyCounty_1},
            {label: "Basemap", layer: layer_Basemap_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        </script>
    </body>
</html>
